<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="theme-color" content="#155DFC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="format-detection" content="telephone=no">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <link rel="stylesheet" href="endstyle.css" />
</head>

<body>
  <div class="prof1">
    <div class="nav">
      <div class="logo">
        <h1 class="h1">Qualimeter</h1>
      </div>
      <div class="part2">
        <div class="a1">
          <a href="#">Тесты</a>
        </div>
        <div class="a2">
          <a href="#">План развития</a>
        </div>
        <div class="a3">
          <a href="#">Повышение</a>
        </div>
        <div class="a4">
          <a href="company.html">Компания</a>
        </div>
      </div>
      <div class="part3" id="userMenu">
        <img src="img/imgprof/user-account_9327873 1 (1).svg" alt="user" class="user-icon" />
        <p>Никита Н.</p>
        <img src="img/imgprof/Vector 1.svg" alt="arrow" class="arrow-icon" />
      </div>
      <div class="dropdown-menu" id="dropdownMenu">
        <div class="menu-section">
          <div class="menu-item-with-icon">
            <img src="img/imgprof/person.svg" alt="" class="menu-icon" />
            <a href="#" class="menu-link main-link">Профиль</a>
          </div>
          <div class="menu-item-with-icon">
            <img src="img/imgprof/settings.svg" alt="" class="menu-icon" />
            <a href="#" class="menu-link">Настройки</a>
          </div>
          <div class="menu-item-with-icon">
            <img src="img/imgprof/notifications_unread.svg" alt="" class="menu-icon" />
            <a href="#" class="menu-link">Уведомления</a>
          </div>
          <div class="menu-item-with-icon logout">
            <img src="img/imgprof/logout.svg" alt="" class="menu-icon" />
            <a href="#" class="menu-link">Выйти</a>
          </div>
        </div>
      </div>
    </div>
    <img src="img/imgprof/blending 1 (1).svg" alt="" class="imgreg" />
    <img src="img/imgprof/blending 1 (2).svg" alt="" class="imgreg1" />
    <img src="img/imgprof/blending 1 (3).svg" alt="" class="imgreg2" />
    <div class="end">
      <h2>Вы уверены, что хотите выйти из аккаунта?</h2>
      <p>Вы выходите из аккаунта. </p>
      <p>Для следующего входа вам понадобится снова ввести логин и пароль.</p>
      <div>
        <div class="a1">
          <a href="prof.html">Остаться</a>
        </div>
        <div class="a2">
          <a href="index.html">Выйти</a>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Проверяем, вошел ли пользователь
    const currentUser = localStorage.getItem('currentUser');
    if (!currentUser) {
      alert('Пожалуйста, войдите в систему');
      window.location.href = 'enter.html';
    }

    // Функция для загрузки данных пользователя
    function loadUserData() {
      try {
        const userDataStr = localStorage.getItem('currentUser');

        if (!userDataStr) {
          console.error('Данные пользователя не найдены');
          return;
        }

        const userData = JSON.parse(userDataStr);

        // Извлекаем имя и фамилию
        let firstName = '';
        let lastName = '';

        if (userData.name) {
          firstName = userData.name;
        } else if (userData.firstName) {
          firstName = userData.firstName;
        } else if (userData.username) {
          firstName = userData.username;
        } else if (userData.login) {
          firstName = userData.login;
        }

        if (userData.lastname) {
          lastName = userData.lastname;
        } else if (userData.lastName) {
          lastName = userData.lastName;
        }

        // Если в поле name есть и имя и фамилия, разделяем их
        if (userData.name && userData.name.includes(' ')) {
          const nameParts = userData.name.split(' ');
          firstName = nameParts[0] || firstName;
          lastName = nameParts.slice(1).join(' ') || lastName;
        }

        // Формируем короткое имя для меню (Имя Ф.)
        let shortName = firstName;
        if (lastName) {
          const lastNameInitial = lastName.charAt(0);
          shortName += ' ' + lastNameInitial + '.';
        }

        // Находим элемент для имени в меню
        const userMenuNameElement = document.querySelector('.part3 p');
        if (userMenuNameElement) {
          userMenuNameElement.textContent = shortName;
        }

      } catch (error) {
        console.error('Ошибка при загрузке данных пользователя:', error);
        const userMenuNameElement = document.querySelector('.part3 p');
        if (userMenuNameElement) {
          userMenuNameElement.textContent = 'Пользователь';
        }
      }
    }

    document.addEventListener("DOMContentLoaded", function () {
      // Загружаем данные пользователя
      loadUserData();

      const userMenu = document.getElementById("userMenu");
      const dropdownMenu = document.getElementById("dropdownMenu");

      // Функция для переключения меню
      function toggleMenu(e) {
        e.preventDefault();
        e.stopPropagation();
        dropdownMenu.classList.toggle("active");
        userMenu.classList.toggle("active");
      }

      // Обработчики для десктопов и мобильных
      if (userMenu) {
        userMenu.addEventListener("click", toggleMenu);
        userMenu.addEventListener("touchstart", toggleMenu);
      }

      // Закрытие меню при клике вне его
      function closeMenu() {
        if (dropdownMenu) {
          dropdownMenu.classList.remove("active");
        }
        if (userMenu) {
          userMenu.classList.remove("active");
        }
      }

      document.addEventListener("click", closeMenu);
      document.addEventListener("touchstart", closeMenu);

      // Предотвращение закрытия при клике внутри меню
      if (dropdownMenu) {
        dropdownMenu.addEventListener("click", function (e) {
          e.stopPropagation();
        });
        dropdownMenu.addEventListener("touchstart", function (e) {
          e.stopPropagation();
        });
      }

      // Обработка кнопки "Выйти" - очищаем localStorage и перенаправляем
      const logoutButton = document.querySelector('.a2 a');
      if (logoutButton) {
        logoutButton.addEventListener('click', function (e) {
          e.preventDefault();
          localStorage.removeItem('currentUser');
          window.location.href = 'index.html'; // или index.html, если у вас есть главная
        });
      }

      // Обработка кнопки "Остаться" - просто возвращаемся в профиль
      const stayButton = document.querySelector('.a1 a');
      if (stayButton) {
        stayButton.addEventListener('click', function (e) {
          e.preventDefault();
          window.location.href = 'prof.html';
        });
      }
    });
    // mobile.js - улучшения для мобильных устройств
    document.addEventListener('DOMContentLoaded', function () {
      // Определяем мобильное устройство
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

      if (isMobile) {
        // Увеличиваем область клика для всех кнопок и ссылок
        document.querySelectorAll('a, button, .menu-item-with-icon, .switch-btn').forEach(element => {
          element.style.minHeight = '44px';
          element.style.minWidth = '44px';
        });

        // Улучшаем touch события
        document.querySelectorAll('.password-toggle, .btn, .switch-btn').forEach(button => {
          button.addEventListener('touchstart', function () {
            this.style.transform = 'scale(0.98)';
          });

          button.addEventListener('touchend', function () {
            this.style.transform = 'scale(1)';
          });
        });

        // Предотвращаем масштабирование при двойном тапе на полях ввода
        document.querySelectorAll('input, textarea').forEach(field => {
          field.addEventListener('touchstart', function (e) {
            if (e.touches.length > 1) {
              e.preventDefault();
            }
          }, { passive: false });
        });

        // Улучшаем скролл на мобильных
        document.body.style.overflow = 'auto';
        document.body.style.webkitOverflowScrolling = 'touch';

        // Скрываем нативные стрелки ввода на iOS
        if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
          document.querySelectorAll('input[type="number"]').forEach(input => {
            input.style.appearance = 'none';
            input.style.MozAppearance = 'textfield';
          });
        }
      }
    });
  </script>
</body>

</html>